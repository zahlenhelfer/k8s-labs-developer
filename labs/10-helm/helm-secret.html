<h1 id="übung-helm-chart-das-ein-kubernetes-secret-erstellt">🧪 Übung:
Helm-Chart, das ein Kubernetes Secret erstellt</h1>
<hr />
<h2 id="ziel">🎯 Ziel</h2>
<ul>
<li>Ein Helm-Chart erstellen</li>
<li>Ein Kubernetes Secret via Template anlegen</li>
<li>Secret im Deployment als Umgebungsvariable nutzen</li>
</ul>
<hr />
<h2 id="schritt-1-neues-helm-chart-anlegen">📁 Schritt 1: Neues
Helm-Chart anlegen</h2>
<div class="sourceCode" id="cb1"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">helm</span> create secret-demo</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> secret-demo</span></code></pre></div>
<hr />
<h2 id="schritt-2-secret-template-anlegen">📁 Schritt 2: Secret Template
anlegen</h2>
<p>Erstelle Datei <code>templates/secret.yaml</code> mit folgendem
Inhalt:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Secret</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span><span class="at">{ include </span><span class="st">&quot;secret-demo.fullname&quot;</span><span class="at"> . </span><span class="kw">}</span><span class="at">}-secret</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">type</span><span class="kw">:</span><span class="at"> Opaque</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span><span class="kw">:</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">  # base64-kodierte Werte</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">username</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span><span class="at">{ .Values.secret.username | b64enc | quote </span><span class="kw">}</span><span class="at">}</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">password</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span><span class="at">{ .Values.secret.password | b64enc | quote </span><span class="kw">}</span><span class="at">}</span></span></code></pre></div>
<hr />
<h2 id="schritt-3-werte-in-values.yaml-definieren">📁 Schritt 3: Werte
in values.yaml definieren</h2>
<p>Füge in <code>values.yaml</code> folgendes hinzu:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">secret</span><span class="kw">:</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">username</span><span class="kw">:</span><span class="at"> admin</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">password</span><span class="kw">:</span><span class="at"> s3cr3tpass</span></span></code></pre></div>
<hr />
<h2 id="schritt-4-deployment-anpassen-um-secret-zu-nutzen">📁 Schritt 4:
Deployment anpassen, um Secret zu nutzen</h2>
<p>Öffne <code>templates/deployment.yaml</code> und ergänze unter
<code>spec.template.spec.containers[0]</code> folgendes (innerhalb
<code>env:</code>):</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">env</span><span class="kw">:</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> USERNAME</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">valueFrom</span><span class="kw">:</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">secretKeyRef</span><span class="kw">:</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span><span class="at">{ include </span><span class="st">&quot;secret-demo.fullname&quot;</span><span class="at"> . </span><span class="kw">}</span><span class="at">}-secret</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">key</span><span class="kw">:</span><span class="at"> username</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> PASSWORD</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">valueFrom</span><span class="kw">:</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">secretKeyRef</span><span class="kw">:</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span><span class="at">{ include </span><span class="st">&quot;secret-demo.fullname&quot;</span><span class="at"> . </span><span class="kw">}</span><span class="at">}-secret</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">key</span><span class="kw">:</span><span class="at"> password</span></span></code></pre></div>
<p>Falls <code>env:</code> noch nicht da ist, lege es an.</p>
<hr />
<h2 id="schritt-5-chart-deployen">📁 Schritt 5: Chart deployen</h2>
<div class="sourceCode" id="cb5"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">helm</span> install my-secret-demo . </span></code></pre></div>
<hr />
<h2 id="schritt-6-prüfen">📁 Schritt 6: Prüfen</h2>
<ul>
<li>Secret anschauen:</li>
</ul>
<div class="sourceCode" id="cb6"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get secret my-secret-demo-secret <span class="at">-o</span> yaml</span></code></pre></div>
<ul>
<li>Pod-Umgebungsvariablen prüfen (z.B. mit <code>kubectl exec</code>
oder Logs).</li>
</ul>
<hr />
<h2 id="schritt-7-werte-anpassen-upgrade">📁 Schritt 7: Werte anpassen
&amp; Upgrade</h2>
<div class="sourceCode" id="cb7"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">helm</span> upgrade my-secret-demo . <span class="at">--set</span> secret.password=newpass123</span></code></pre></div>
<hr />
<h2 id="zusammenfassung">Zusammenfassung</h2>
<p>Mit Helm kannst du Kubernetes-Secrets bequem als Template erstellen
und dynamisch Werte aus <code>values.yaml</code> einfügen. Damit lassen
sich sensible Daten sicher verwalten und in Deployments verwenden.</p>
